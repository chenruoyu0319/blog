<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AWS Lambda 部署 SpringBoot 应用 | HelloWood</title>
    <meta name="description" content="There is path to everyone">
    <link rel="icon" href="/blog/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.ad3369ca.css" as="style"><link rel="preload" href="/blog/assets/js/app.c3b8d897.js" as="script"><link rel="preload" href="/blog/assets/js/65.d11a02e4.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.da86b7bd.js"><link rel="prefetch" href="/blog/assets/js/100.1fda9c7b.js"><link rel="prefetch" href="/blog/assets/js/101.d6e48f6b.js"><link rel="prefetch" href="/blog/assets/js/102.bba9eb7e.js"><link rel="prefetch" href="/blog/assets/js/103.9130ca26.js"><link rel="prefetch" href="/blog/assets/js/104.17feb6c0.js"><link rel="prefetch" href="/blog/assets/js/105.2d88b9c6.js"><link rel="prefetch" href="/blog/assets/js/106.60aab3d6.js"><link rel="prefetch" href="/blog/assets/js/107.0b445758.js"><link rel="prefetch" href="/blog/assets/js/108.24b24aee.js"><link rel="prefetch" href="/blog/assets/js/109.e2dfc393.js"><link rel="prefetch" href="/blog/assets/js/11.a9db4537.js"><link rel="prefetch" href="/blog/assets/js/110.5e99609b.js"><link rel="prefetch" href="/blog/assets/js/111.1d728c12.js"><link rel="prefetch" href="/blog/assets/js/112.0dc96157.js"><link rel="prefetch" href="/blog/assets/js/113.2dd7f283.js"><link rel="prefetch" href="/blog/assets/js/114.592ea6c3.js"><link rel="prefetch" href="/blog/assets/js/115.02255f30.js"><link rel="prefetch" href="/blog/assets/js/116.ef5309f5.js"><link rel="prefetch" href="/blog/assets/js/117.c34f674b.js"><link rel="prefetch" href="/blog/assets/js/118.54f8bd90.js"><link rel="prefetch" href="/blog/assets/js/119.61245eae.js"><link rel="prefetch" href="/blog/assets/js/12.8583d81f.js"><link rel="prefetch" href="/blog/assets/js/120.a434adb5.js"><link rel="prefetch" href="/blog/assets/js/121.fc914209.js"><link rel="prefetch" href="/blog/assets/js/122.20dc77aa.js"><link rel="prefetch" href="/blog/assets/js/13.9ae3b3e9.js"><link rel="prefetch" href="/blog/assets/js/14.11ff3f38.js"><link rel="prefetch" href="/blog/assets/js/15.688067b9.js"><link rel="prefetch" href="/blog/assets/js/16.427cec0a.js"><link rel="prefetch" href="/blog/assets/js/17.98f70d8f.js"><link rel="prefetch" href="/blog/assets/js/18.b4ab36f9.js"><link rel="prefetch" href="/blog/assets/js/19.7e0b8dc9.js"><link rel="prefetch" href="/blog/assets/js/2.8cfd1be3.js"><link rel="prefetch" href="/blog/assets/js/20.adf7d5c8.js"><link rel="prefetch" href="/blog/assets/js/21.bb9eafed.js"><link rel="prefetch" href="/blog/assets/js/22.5ed2a178.js"><link rel="prefetch" href="/blog/assets/js/23.99d24170.js"><link rel="prefetch" href="/blog/assets/js/24.bc475600.js"><link rel="prefetch" href="/blog/assets/js/25.e457e40c.js"><link rel="prefetch" href="/blog/assets/js/26.b4236411.js"><link rel="prefetch" href="/blog/assets/js/27.cc233ffc.js"><link rel="prefetch" href="/blog/assets/js/28.88e37db5.js"><link rel="prefetch" href="/blog/assets/js/29.d8334253.js"><link rel="prefetch" href="/blog/assets/js/3.85eafc6e.js"><link rel="prefetch" href="/blog/assets/js/30.036a6581.js"><link rel="prefetch" href="/blog/assets/js/31.39636870.js"><link rel="prefetch" href="/blog/assets/js/32.4f1b9fe5.js"><link rel="prefetch" href="/blog/assets/js/33.f5fccb87.js"><link rel="prefetch" href="/blog/assets/js/34.8f223cf7.js"><link rel="prefetch" href="/blog/assets/js/35.2eb95af5.js"><link rel="prefetch" href="/blog/assets/js/36.bb3a4c24.js"><link rel="prefetch" href="/blog/assets/js/37.37386f66.js"><link rel="prefetch" href="/blog/assets/js/38.148c6dd1.js"><link rel="prefetch" href="/blog/assets/js/39.7e86da97.js"><link rel="prefetch" href="/blog/assets/js/4.25bf5105.js"><link rel="prefetch" href="/blog/assets/js/40.f7d3b58a.js"><link rel="prefetch" href="/blog/assets/js/41.410d464b.js"><link rel="prefetch" href="/blog/assets/js/42.3605393d.js"><link rel="prefetch" href="/blog/assets/js/43.5de0724c.js"><link rel="prefetch" href="/blog/assets/js/44.23f62410.js"><link rel="prefetch" href="/blog/assets/js/45.be9ef252.js"><link rel="prefetch" href="/blog/assets/js/46.c12425b6.js"><link rel="prefetch" href="/blog/assets/js/47.ce3ec49d.js"><link rel="prefetch" href="/blog/assets/js/48.e952f7c9.js"><link rel="prefetch" href="/blog/assets/js/49.54ff7f6f.js"><link rel="prefetch" href="/blog/assets/js/5.63c626c0.js"><link rel="prefetch" href="/blog/assets/js/50.b7711518.js"><link rel="prefetch" href="/blog/assets/js/51.03a13657.js"><link rel="prefetch" href="/blog/assets/js/52.3892d45c.js"><link rel="prefetch" href="/blog/assets/js/53.81de0db8.js"><link rel="prefetch" href="/blog/assets/js/54.cd38387d.js"><link rel="prefetch" href="/blog/assets/js/55.8d91faa8.js"><link rel="prefetch" href="/blog/assets/js/56.4eec9a52.js"><link rel="prefetch" href="/blog/assets/js/57.f71bbce3.js"><link rel="prefetch" href="/blog/assets/js/58.95eddb54.js"><link rel="prefetch" href="/blog/assets/js/59.16df2f6b.js"><link rel="prefetch" href="/blog/assets/js/6.3cf64e25.js"><link rel="prefetch" href="/blog/assets/js/60.2429cfb7.js"><link rel="prefetch" href="/blog/assets/js/61.14655cd6.js"><link rel="prefetch" href="/blog/assets/js/62.9c2b33ad.js"><link rel="prefetch" href="/blog/assets/js/63.2d91c668.js"><link rel="prefetch" href="/blog/assets/js/64.f4834597.js"><link rel="prefetch" href="/blog/assets/js/66.4326ba51.js"><link rel="prefetch" href="/blog/assets/js/67.cb1dc555.js"><link rel="prefetch" href="/blog/assets/js/68.a83dc049.js"><link rel="prefetch" href="/blog/assets/js/69.d1f07348.js"><link rel="prefetch" href="/blog/assets/js/7.9cbb0d6f.js"><link rel="prefetch" href="/blog/assets/js/70.f96025df.js"><link rel="prefetch" href="/blog/assets/js/71.af522fcf.js"><link rel="prefetch" href="/blog/assets/js/72.9ec2197b.js"><link rel="prefetch" href="/blog/assets/js/73.95bc1d2c.js"><link rel="prefetch" href="/blog/assets/js/74.8bdf0ff5.js"><link rel="prefetch" href="/blog/assets/js/75.adfb40ef.js"><link rel="prefetch" href="/blog/assets/js/76.1e88405d.js"><link rel="prefetch" href="/blog/assets/js/77.32a459de.js"><link rel="prefetch" href="/blog/assets/js/78.05684469.js"><link rel="prefetch" href="/blog/assets/js/79.6eb82fa7.js"><link rel="prefetch" href="/blog/assets/js/8.a853dfa7.js"><link rel="prefetch" href="/blog/assets/js/80.8d4b06e9.js"><link rel="prefetch" href="/blog/assets/js/81.74e68934.js"><link rel="prefetch" href="/blog/assets/js/82.0497f220.js"><link rel="prefetch" href="/blog/assets/js/83.98a0e98c.js"><link rel="prefetch" href="/blog/assets/js/84.4267a125.js"><link rel="prefetch" href="/blog/assets/js/85.4c9c338e.js"><link rel="prefetch" href="/blog/assets/js/86.7d4985b4.js"><link rel="prefetch" href="/blog/assets/js/87.33c61c72.js"><link rel="prefetch" href="/blog/assets/js/88.49bd3481.js"><link rel="prefetch" href="/blog/assets/js/89.2ceb6118.js"><link rel="prefetch" href="/blog/assets/js/9.b85f95f3.js"><link rel="prefetch" href="/blog/assets/js/90.bfa5d02e.js"><link rel="prefetch" href="/blog/assets/js/91.faa858b0.js"><link rel="prefetch" href="/blog/assets/js/92.5e8f5328.js"><link rel="prefetch" href="/blog/assets/js/93.9100f2a7.js"><link rel="prefetch" href="/blog/assets/js/94.79d7ea18.js"><link rel="prefetch" href="/blog/assets/js/95.60447753.js"><link rel="prefetch" href="/blog/assets/js/96.f0bac547.js"><link rel="prefetch" href="/blog/assets/js/97.fcb5a63e.js"><link rel="prefetch" href="/blog/assets/js/98.fd71af61.js"><link rel="prefetch" href="/blog/assets/js/99.f0ef3ad6.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.ad3369ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">HelloWood</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">About</a></div> <a href="https://github.com/helloworlde/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">About</a></div> <a href="https://github.com/helloworlde/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Angular</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Gauge</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Gradle</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>IDEA</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>MQ</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Others</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Seata</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Serverless</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/blog/Serverless/AWS-Lambda-部署-SpringBoot-应用.html" class="active sidebar-link">AWS Lambda 部署 SpringBoot 应用</a></li><li><a href="/blog/blog/Serverless/Google-Cloud-Run-部署-Knative-Serverless-应用.html" class="sidebar-link">Google Cloud Run 部署 Knative Serverless 应用</a></li><li><a href="/blog/blog/Serverless/使用腾讯云的Serverless部署天气应用.html" class="sidebar-link">使用腾讯云的Serverless部署天气应用</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SpringBoot</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SpringCloud</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>SpringMVC</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Ubuntu</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Windows</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>RaspBerryPi</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="aws-lambda-部署-springboot-应用"><a href="#aws-lambda-部署-springboot-应用" aria-hidden="true" class="header-anchor">#</a> AWS Lambda 部署 SpringBoot 应用</h1> <h2 id="配置-aws-cli-和-severless"><a href="#配置-aws-cli-和-severless" aria-hidden="true" class="header-anchor">#</a> 配置 AWS CLI 和  Severless</h2> <p>AWS CLI 和 Serverless 都可以用于部署 Serverless 应用</p> <h3 id="获取密钥"><a href="#获取密钥" aria-hidden="true" class="header-anchor">#</a> 获取密钥</h3> <ol><li>登录 AWS， 在服务中搜索并选择 IAM，之后选择用户，添加用户</li></ol> <p><img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless1.png" alt="Serverless1"></p> <ol start="2"><li>输入用户名，选择编程访问</li></ol> <p><img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless2-add-user.png" alt="Serverless2-add-user"></p> <ol start="3"><li>选择权限-直接附加现有策略，搜索<code>AdministratorAccess</code>并选中(有最高权限)</li></ol> <p><img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless3-add-permission.png" alt="Serverless3-add-permission"></p> <ol start="4"><li>选择下一步直到完成，然后保存好密钥(只会出现这一次，否则就只能重新创建)</li></ol> <p><img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless4-save-secret.png" alt="Serverless3-save-secret"></p> <h3 id="安装配置-aws-cli"><a href="#安装配置-aws-cli" aria-hidden="true" class="header-anchor">#</a> 安装配置 AWS CLI</h3> <h4 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h4> <p>参考 <a href="https://aws.amazon.com/cn/cli/" target="_blank" rel="noopener noreferrer">AWS 命令行界面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 安装</p> <ul><li>Win 下载 <a href="https://s3.amazonaws.com/aws-cli/AWSCLI64.msi" target="_blank" rel="noopener noreferrer">https://s3.amazonaws.com/aws-cli/AWSCLI64.msi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 安装</li> <li>Mac/Linux 执行 <code>pip install awscli</code></li></ul> <h4 id="配置-aws-cli"><a href="#配置-aws-cli" aria-hidden="true" class="header-anchor">#</a> 配置 AWS CLI</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>aws configure
</code></pre></div><p>然后输入刚才的密钥的 Key 和 Secret，Region 可以选择常用的 region，如<code>us-east-1</code></p> <h3 id="安装配置-severless"><a href="#安装配置-severless" aria-hidden="true" class="header-anchor">#</a> 安装配置 Severless</h3> <h4 id="安装-2"><a href="#安装-2" aria-hidden="true" class="header-anchor">#</a> 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g serverless

或 

yarn global add serverless
</code></pre></div><h4 id="配置"><a href="#配置" aria-hidden="true" class="header-anchor">#</a> 配置</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>
serverless config credentials --provider aws --key YOUR_KEY --secret YOUR_SECRET

</code></pre></div><h3 id="安装配置-aws-sam-local"><a href="#安装配置-aws-sam-local" aria-hidden="true" class="header-anchor">#</a> 安装配置 AWS SAM Local</h3> <p>aws-sam-local 是用于本地调试 Serverless 应用的工具</p> <h4 id="安装-3"><a href="#安装-3" aria-hidden="true" class="header-anchor">#</a> 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g aws-sam-local

或

yarn global add aws-sam-local
</code></pre></div><h2 id="创建-spring-boot-应用"><a href="#创建-spring-boot-应用" aria-hidden="true" class="header-anchor">#</a> 创建 Spring Boot 应用</h2> <h3 id="通过-maven-插件快速生成"><a href="#通过-maven-插件快速生成" aria-hidden="true" class="header-anchor">#</a> 通过 Maven 插件快速生成</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>mvn archetype:generate \
        -DgroupId<span class="token operator">=</span>io.github.helloworlde \
        -DartifactId<span class="token operator">=</span>serverless-spring-boot \
        -Dversion<span class="token operator">=</span>1.0-SNAPSHOT \
        -DarchetypeGroupId<span class="token operator">=</span>com.amazonaws.serverless.archetypes \
        -DarchetypeArtifactId<span class="token operator">=</span>aws-serverless-springboot2-archetype \
        -DarchetypeVersion<span class="token operator">=</span>1.3.1
</code></pre></div><ul><li>项目文件</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">.</span>
├── README.md
├── build.gradle
├── pom.xml
├── sam.yaml
└── src
    ├── assembly
    │   └── bin.xml
    ├── main
    │   ├── java
    │   │   └── io
    │   │       └── github
    │   │           └── helloworlde
    │   │               ├── Application.java
    │   │               ├── StreamLambdaHandler.java
    │   │               └── controller
    │   │                   └── PingController.java
    │   └── resources
    │       └── application.properties
    └── <span class="token function">test</span>
        └── java
            └── io
                └── github
                    └── helloworlde
                        └── StreamLambdaHandlerTest.java
</code></pre></div><h3 id="手动创建"><a href="#手动创建" aria-hidden="true" class="header-anchor">#</a> 手动创建</h3> <ol><li>创建 SpringBoot 应用</li> <li>修改 build.gradle</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>buildscript <span class="token punctuation">{</span>
    ext <span class="token punctuation">{</span>
        springBootVersion <span class="token operator">=</span> <span class="token string">'2.1.1.RELEASE'</span>
    <span class="token punctuation">}</span>
    repositories <span class="token punctuation">{</span>
        <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    dependencies <span class="token punctuation">{</span>
        <span class="token function">classpath</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.springframework.boot:spring-boot-gradle-plugin:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>springBootVersion<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


apply plugin<span class="token punctuation">:</span> <span class="token string">'java'</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">'org.springframework.boot'</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">'io.spring.dependency-management'</span>


archivesBaseName <span class="token operator">=</span> <span class="token string">'serverless-spring-boot'</span>
group <span class="token operator">=</span> <span class="token string">'io.github.helloworlde'</span>
version <span class="token operator">=</span> <span class="token string">'0.0.1-SNAPSHOT'</span>
sourceCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>

repositories <span class="token punctuation">{</span>
    <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">mavenLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token function">compile</span><span class="token punctuation">(</span>
            <span class="token string">'org.springframework.boot:spring-boot-starter-web'</span><span class="token punctuation">,</span>
            <span class="token string">'com.amazonaws.serverless:aws-serverless-java-container-spring:[1.0,)'</span><span class="token punctuation">,</span>
            <span class="token string">'io.symphonia:lambda-logging:1.0.1'</span>
    <span class="token punctuation">)</span>

    <span class="token function">testCompile</span><span class="token punctuation">(</span><span class="token string gstring">&quot;junit:junit:4.12&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

task <span class="token function">buildZip</span><span class="token punctuation">(</span>type<span class="token punctuation">:</span> Zip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    from compileJava
    from processResources
    <span class="token function">into</span><span class="token punctuation">(</span><span class="token string">'lib'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">from</span><span class="token punctuation">(</span>configurations<span class="token operator">.</span>compileClasspath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exclude <span class="token string">'tomcat-embed-*'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

build<span class="token operator">.</span>dependsOn buildZip
</code></pre></div><ul><li>添加 PingController.java</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>helloworlde<span class="token punctuation">.</span>controller<span class="token punctuation">;</span>


<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>EnableWebMvc<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>


<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PingController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">&quot;/ping&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> pong <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pong<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;pong&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pong<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>添加 StreamLamdbaHandler.java</li></ul> <p>StreamLamdbaHandler 相当于一个代理层，将访问 Lambda 的流量转发给 SpringBoot应用；handleRequest方法每次请求都会被调用</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>helloworlde<span class="token punctuation">;</span>


<span class="token keyword">import</span> com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ContainerInitializationException<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>model<span class="token punctuation">.</span>AwsProxyRequest<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>model<span class="token punctuation">.</span>AwsProxyResponse<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>SpringBootLambdaContainerHandler<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>lambda<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>Context<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>lambda<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>RequestStreamHandler<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>OutputStream<span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamLambdaHandler</span> <span class="token keyword">implements</span> <span class="token class-name">RequestStreamHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> SpringBootLambdaContainerHandler<span class="token generics function"><span class="token punctuation">&lt;</span>AwsProxyRequest<span class="token punctuation">,</span> AwsProxyResponse<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            handler <span class="token operator">=</span> SpringBootLambdaContainerHandler<span class="token punctuation">.</span><span class="token function">getAwsProxyHandler</span><span class="token punctuation">(</span>Application<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ContainerInitializationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// if we fail here. We re-throw the exception to force another cold start</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Could not initialize Spring Boot application&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>InputStream inputStream<span class="token punctuation">,</span> OutputStream outputStream<span class="token punctuation">,</span> Context context<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        handler<span class="token punctuation">.</span><span class="token function">proxyStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> outputStream<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>添加 sam.yaml</li></ul> <p>sam 用于本地测试Serverless 应用，依赖于 Python 和 Docker</p> <p>需要注意的是，<code>Resources.ServerlessSpringBootFunction.Properties.CodeUri</code>这个路径需要根据使用 Gradle 或 Maven 进行修改</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">AWSTemplateFormatVersion</span><span class="token punctuation">:</span> <span class="token string">'2010-09-09'</span>
<span class="token key atrule">Transform</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">-</span><span class="token datetime number">2016-10-31</span>
<span class="token key atrule">Description</span><span class="token punctuation">:</span> AWS Serverless Spring Boot 2 API <span class="token punctuation">-</span> io.github.helloworlde<span class="token punctuation">:</span><span class="token punctuation">:</span>serverless<span class="token punctuation">-</span>spring<span class="token punctuation">-</span>boot
<span class="token key atrule">Globals</span><span class="token punctuation">:</span>
  <span class="token key atrule">Api</span><span class="token punctuation">:</span>
    <span class="token key atrule">EndpointConfiguration</span><span class="token punctuation">:</span> REGIONAL

<span class="token key atrule">Resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">ServerlessSpringBootFunction</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>Function
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">Handler</span><span class="token punctuation">:</span> io.github.helloworlde.StreamLambdaHandler<span class="token punctuation">:</span><span class="token punctuation">:</span>handleRequest
      <span class="token key atrule">Runtime</span><span class="token punctuation">:</span> java8
      <span class="token key atrule">CodeUri</span><span class="token punctuation">:</span> build/distributions/serverless<span class="token punctuation">-</span>spring<span class="token punctuation">-</span>boot.zip
      <span class="token key atrule">MemorySize</span><span class="token punctuation">:</span> <span class="token number">512</span>
      <span class="token key atrule">Policies</span><span class="token punctuation">:</span> AWSLambdaBasicExecutionRole
      <span class="token key atrule">Timeout</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">Events</span><span class="token punctuation">:</span>
        <span class="token key atrule">GetResource</span><span class="token punctuation">:</span>
          <span class="token key atrule">Type</span><span class="token punctuation">:</span> Api
          <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
            <span class="token key atrule">Path</span><span class="token punctuation">:</span> /<span class="token punctuation">{</span>proxy+<span class="token punctuation">}</span>
            <span class="token key atrule">Method</span><span class="token punctuation">:</span> any

<span class="token key atrule">Outputs</span><span class="token punctuation">:</span>
  <span class="token key atrule">ServerlessSpringBootApi</span><span class="token punctuation">:</span>
    <span class="token key atrule">Description</span><span class="token punctuation">:</span> URL for application
    <span class="token key atrule">Value</span><span class="token punctuation">:</span> <span class="token tag">!Sub</span> <span class="token string">'https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/ping'</span>
    <span class="token key atrule">Export</span><span class="token punctuation">:</span>
      <span class="token key atrule">Name</span><span class="token punctuation">:</span> ServerlessSpringBootApi
</code></pre></div><h2 id="测试"><a href="#测试" aria-hidden="true" class="header-anchor">#</a> 测试</h2> <h3 id="编译生成-zip"><a href="#编译生成-zip" aria-hidden="true" class="header-anchor">#</a> 编译生成 zip</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>gradle clean build
</code></pre></div><h3 id="测试应用接口"><a href="#测试应用接口" aria-hidden="true" class="header-anchor">#</a> 测试应用接口</h3> <ol><li>启动应用</li> <li>访问 <code>http://localhost:8080/ping</code>，应当返回结果：</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;pong&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello, World!&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用-sam-测试"><a href="#使用-sam-测试" aria-hidden="true" class="header-anchor">#</a> 使用 SAM 测试</h3> <div class="language-java extra-class"><pre class="language-java"><code>sam local start<span class="token operator">-</span>api <span class="token operator">--</span>template sam<span class="token punctuation">.</span>yaml
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> -s http://127.0.0.1:3000/ping
</code></pre></div><p>将会看到输出结果：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;pong&quot;</span><span class="token operator">:</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">}</span>%
</code></pre></div><h2 id="部署"><a href="#部署" aria-hidden="true" class="header-anchor">#</a> 部署</h2> <h3 id="serverless-部署"><a href="#serverless-部署" aria-hidden="true" class="header-anchor">#</a> Serverless 部署</h3> <ul><li>在项目根路径中添加 serverless.yml 配置</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">service</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>boot<span class="token punctuation">-</span>serverless

<span class="token key atrule">provider</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aws
  <span class="token key atrule">runtime</span><span class="token punctuation">:</span> java8

<span class="token key atrule">package</span><span class="token punctuation">:</span>
  <span class="token key atrule">artifact</span><span class="token punctuation">:</span> build/distributions/serverless<span class="token punctuation">-</span>spring<span class="token punctuation">-</span>boot.zip

<span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">springBootServerless</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> io.github.helloworlde.StreamLambdaHandler<span class="token punctuation">:</span><span class="token punctuation">:</span>handleRequest
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /ping
          <span class="token key atrule">method</span><span class="token punctuation">:</span> get
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">30</span>
</code></pre></div><ul><li>发布</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>sls deploy
</code></pre></div><p>日志：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>sls deploy                             
Serverless: Packaging service<span class="token punctuation">..</span>.
Serverless: Uploading CloudFormation <span class="token function">file</span> to S3<span class="token punctuation">..</span>.
Serverless: Uploading artifacts<span class="token punctuation">..</span>.
Serverless: Uploading <span class="token function">service</span> serverless-spring-boot.zip <span class="token function">file</span> to S3 <span class="token punctuation">(</span>12.73 MB<span class="token punctuation">)</span><span class="token punctuation">..</span>.
Serverless: Validating template<span class="token punctuation">..</span>.
Serverless: Updating Stack<span class="token punctuation">..</span>.
Serverless: Checking Stack update progress<span class="token punctuation">..</span>.
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Serverless: Stack update finished<span class="token punctuation">..</span>.
Service Information
service: spring-boot-serverless
stage: dev
region: us-east-1
stack: spring-boot-serverless-dev
resources: 10
api keys:
  None
endpoints:
  GET - https://cmu9z3fmd1.execute-api.us-east-1.amazonaws.com/dev/ping
functions:
  springBootServerless: spring-boot-serverless-dev-springBootServerless
layers:
  None

</code></pre></div><ul><li>访问</li></ul> <p>访问 <a href="https://cmu9z3fmd1.execute-api.us-east-1.amazonaws.com/dev/ping" target="_blank" rel="noopener noreferrer">https://cmu9z3fmd1.execute-api.us-east-1.amazonaws.com/dev/ping<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;pong&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello, World!&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用-aws-cli-发布"><a href="#使用-aws-cli-发布" aria-hidden="true" class="header-anchor">#</a> 使用 AWS CLI 发布</h3> <h4 id="上传到-s3"><a href="#上传到-s3" aria-hidden="true" class="header-anchor">#</a> 上传到 S3</h4> <p>上传到 S3 时需要有一个 Bucket 存在，可以在 AWS 服务-S3 中创建</p> <ul><li>创建 Bucket</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>aws s3 mb s3://spring-boot-serverless --region us-east-1
</code></pre></div><ul><li>上传应用</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>aws cloudformation package --template-file sam.yaml --output-template-file output-sam.yaml --s3-bucket spring-boot-serverless 
</code></pre></div><p>这个命令执行之后会在项目根目录下生成一个 <code>output-sam.yaml</code></p> <p>输出</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Uploading to e793ef8960075db672fce0a8ac65f03b  13353411 / 13353411.0  <span class="token punctuation">(</span>100.00%<span class="token punctuation">)</span>
Successfully packaged artifacts and wrote output template to <span class="token function">file</span> output-sam.yaml.
Execute the following <span class="token function">command</span> to deploy the packaged template
aws cloudformation deploy --template-file /Users/HelloWood/Dev/Projects/Serverless/serverless-spring-boot/output-sam.yaml --stack-name spring-boot-serverless

</code></pre></div><h4 id="部署-2"><a href="#部署-2" aria-hidden="true" class="header-anchor">#</a> 部署</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>aws cloudformation deploy --template-file /Users/HelloWood/Dev/Projects/Serverless/serverless-spring-boot/output-sam.yaml --stack-name spring-boot-serverless-demo --capabilities CAPABILITY_IAM
</code></pre></div><p>需要注意的是 <code>--capabilities CAPABILITY_IAM</code>会创建一个新的角色，会使用 <code>AWSLambdaBasicExecutionRole</code>，该策略仅允许该角色访问 Lambda 相关的资源，也可以使用 <code>CAPABILITY_AUTO_EXPAND</code>或<code>CAPABILITY_NAMED_IAM</code>使用已有的角色；创建后的角色可以在 AWS IAM 的角色下面管理</p> <h4 id="测试-2"><a href="#测试-2" aria-hidden="true" class="header-anchor">#</a> 测试</h4> <ul><li>获取应用信息</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>aws cloudformation describe-stacks --stack-name spring-boot-serverless-demo
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;Stacks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;StackId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:cloudformation:us-east-1:266545579784:stack/spring-boot-serverless-demo/1074b6a0-6f97-11e9-835b-0e348661d726&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;StackName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;spring-boot-serverless-demo&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;ChangeSetId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:cloudformation:us-east-1:266545579784:changeSet/awscli-cloudformation-package-deploy-1557103210/fe06fc3b-a353-4d42-814a-4e4f736a2026&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS Serverless Spring Boot 2 API - io.github.helloworlde::serverless-spring-boot&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;CreationTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2019-05-06T00:37:01.857Z&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;LastUpdatedTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2019-05-06T00:40:17.502Z&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;RollbackConfiguration&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;StackStatus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CREATE_COMPLETE&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;DisableRollback&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;NotificationARNs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Capabilities&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;CAPABILITY_IAM&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;OutputKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ServerlessSpringBootApi&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;OutputValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://gf2c9fhhql.execute-api.us-east-1.amazonaws.com/Prod/ping&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;Description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;URL for application&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;ExportName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ServerlessSpringBootApi&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;EnableTerminationProtection&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;DriftInformation&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;StackDriftStatus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NOT_CHECKED&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>访问 OutputValue 的 URL</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> https://gf2c9fhhql.execute-api.us-east-1.amazonaws.com/Prod/ping
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">{</span><span class="token string">&quot;pong&quot;</span><span class="token keyword">:</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">}</span>%
</code></pre></div><h3 id="页面手动部署"><a href="#页面手动部署" aria-hidden="true" class="header-anchor">#</a> 页面手动部署</h3> <h4 id="创建函数"><a href="#创建函数" aria-hidden="true" class="header-anchor">#</a> 创建函数</h4> <ul><li>选择服务 - Lambda - 函数 - 创建函数 - 从头开始创作</li></ul> <p>权限可以选择现有的角色或者新建角色
<img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless7-create-on-panel.png" alt="Serverless7-create-on-panel"></p> <ul><li>添加触发器，选择 API-Gateway 作为触发器，然后保存</li></ul> <p><img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless8-gateway-trigger.png" alt="Serverless8-gateway-trigger"></p> <ul><li>点击Layers 的 Spring 应用，上传 zip，在 <code>build/</code>或<code>target/</code>下；运行语言选择 Java8，处理程序为<code>io.github.helloworlde.StreamLambdaHandler::handleRequest</code>，点击保存</li></ul> <p><img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless9-upload-app.png" alt="Serverless9-upload-app"></p> <h4 id="测试-3"><a href="#测试-3" aria-hidden="true" class="header-anchor">#</a> 测试</h4> <ul><li>选择配置测试事件 - 创建新测试事件 - 选择 <code>AWS API Gateway AWS Proxy</code>，修改相关的path和httpMethod</li></ul> <p><img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless10-api-gateway-test.png" alt="Serverless10-api-gateway-test"></p> <p><img src="https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless11-test-result.png" alt="Serverless11-test-result"></p> <ul><li>Gateway 的 URL 可以点击 API Gateway查看</li></ul> <hr> <h3 id="项目地址"><a href="#项目地址" aria-hidden="true" class="header-anchor">#</a> 项目地址</h3> <p><a href="https://github.com/helloworlde/serverless-spring-boot" target="_blank" rel="noopener noreferrer">https://github.com/helloworlde/serverless-spring-boot<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="参考文章"><a href="#参考文章" aria-hidden="true" class="header-anchor">#</a> 参考文章</h3> <ul><li><a href="https://skryvets.com/blog/2018/06/02/spring-boot-aws-lambda-guide/" target="_blank" rel="noopener noreferrer">A complete guide for running Spring Boot MVC in the cloud using AWS Lambda<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/java-programming-model.html" target="_blank" rel="noopener noreferrer">使用 Java 构建 Lambda 函数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.aws.amazon.com/zh_cn/serverless-application-model/latest/developerguide/serverless-sam-cli-install-mac.html" target="_blank" rel="noopener noreferrer">Installing the AWS SAM CLI on macOS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.aws.amazon.com/zh_cn/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html" target="_blank" rel="noopener noreferrer">Installing the AWS SAM CLI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.aws.amazon.com/zh_cn/toolkit-for-jetbrains/latest/userguide/key-tasks.html#key-tasks-install" target="_blank" rel="noopener noreferrer">Key Tasks for the AWS Toolkit for JetBrains<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.zhihu.com/question/29490143" target="_blank" rel="noopener noreferrer">如何看待 AWS Lambda<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/awslabs/aws-serverless-java-container" target="_blank" rel="noopener noreferrer">aws-serverless-java-container<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/awslabs/aws-serverless-java-container" target="_blank" rel="noopener noreferrer">Quick start Spring Boot<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5/27/2019, 3:17:18 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/blog/assets/js/app.c3b8d897.js" defer></script><script src="/blog/assets/js/65.d11a02e4.js" defer></script>
  </body>
</html>
