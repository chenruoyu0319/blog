(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{284:function(a,t,s){"use strict";s.r(t);var e=s(0),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"docker-配置-nginx-访问宿主机目录下的应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-配置-nginx-访问宿主机目录下的应用","aria-hidden":"true"}},[a._v("#")]),a._v(" Docker 配置 Nginx 访问宿主机目录下的应用")]),a._v(" "),s("blockquote",[s("p",[a._v("使用 Nginx 将请求转发到宿主机的 Tomcat 应用")])]),a._v(" "),s("h2",{attrs:{id:"配置并启动-tomcat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置并启动-tomcat","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置并启动 Tomcat")]),a._v(" "),s("h2",{attrs:{id:"安装-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装 Docker")]),a._v(" "),s("h2",{attrs:{id:"配置-nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置 Nginx")]),a._v(" "),s("ul",[s("li",[a._v("创建配置和日志文件夹")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /home/nginx/conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /home/nginx/logs\n")])])]),s("ul",[s("li",[a._v("查询宿主机 IP")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker inspect --format "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{{ .NetworkSettings.IPAddress }}'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("container-ID"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或")]),a._v("\ndocker inspect "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("container id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 或")]),a._v("\ndocker inspect -f "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'")]),a._v(" container_name_or_id\n")])])]),s("ul",[s("li",[a._v("添加配置文件 "),s("code",[a._v("nginx.conf")])])]),a._v(" "),s("p",[a._v("将 "),s("code",[a._v("8084")]),a._v("端口转发到"),s("code",[a._v("8080")]),a._v("端口，使用 "),s("code",[a._v("log_format")]),a._v("目的是为了使用阿里云监控切分日志，可以没有")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("log_format proxyformat "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_addr")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request_time")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$http_x_readtime")]),a._v(" ["),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$time_local")]),a._v('] \\"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request_method")]),a._v(" http://"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$host")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request_uri")]),a._v('\\" '),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$status")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$body_bytes_sent")]),a._v(' \\"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$http_referer")]),a._v('\\" \\"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$upstream_addr")]),a._v('\\" \\"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$http_user_agent")]),a._v('\\" \\"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$upstream_response_time")]),a._v('\\" \\"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request_time")]),a._v('\\""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n\n server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      listen 80"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      server_name ali.hellowood.com.cn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        proxy_pass http://172.17.0.1:8080"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        proxy_set_header Host "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$http_host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        proxy_set_header X-Real-IP "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        proxy_set_header X-Forwarded-For "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$proxy_add_x_forwarded_for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("  \n")])])]),s("blockquote",[s("p",[a._v("需要注意的是，Docker 会默认使用桥接路由，所以其 IP 和宿主机的 IP 位于同一 IP 段，并且默认宿主机的 IP 为第一个，即如果 Docker 的 IP 为 "),s("code",[a._v("10.1.0.2")]),a._v(", 则可以通过 访问 "),s("code",[a._v("10.1.0.1")]),a._v(" 访问到宿主机")])]),a._v(" "),s("ul",[s("li",[a._v("拉取 Nginx 镜像")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker pull nginx\n")])])]),s("ul",[s("li",[a._v("启动容器")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker run --name nginx -d -p 8084:80 -v /home/nginx/conf:/etc/nginx/conf.d -v /home/nginx/logs:/var/log/nginx nginx\n")])])]),s("p",[a._v("待容器启动后访问"),s("code",[a._v("http://ali.hellowood.com.cn:8084")]),a._v("就可以看到 Tomcat 的页面了")])])}],!1,null,null,null);r.options.__file="Docker-配置-Nginx-访问宿主机目录下的应用.md";t.default=r.exports}}]);