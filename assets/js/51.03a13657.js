(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{229:function(t,e,s){"use strict";s.r(e);var a=s(0),r=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("chart 就是 Helm 所管理的包，包含着一个应用要部署至 Kubernetes 上所必须的所有资源")]),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("Release 就是 chart 在 Kubernetes 上部署后的实例，chart 每次部署都会产生一次 Release")]),t._v(" "),t._m(5),t._v(" "),s("p",[t._v("存储chart 的仓库，初始化 Helm 时会添加两个仓库，一个是 stable 仓库，地址是"),s("a",{attrs:{href:"https://kubernetes-charts.storage.googleapis.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://kubernetes-charts.storage.googleapis.com/"),s("OutboundLink")],1),t._v(" ，另一个则是 local 仓库，地址是 "),s("a",{attrs:{href:"http://127.0.0.1:8879/charts",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:8879/charts"),s("OutboundLink")],1)]),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),s("p",[t._v("Helm 是一个 C/S 架构，分为客户端helm 和服务端Tiller")]),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),s("p",[t._v("tiller-rbac.yaml")]),t._v(" "),t._m(16),t._m(17),t._m(18),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._m(22),t._m(23),t._v(" "),t._m(24),t._m(25),t._m(26),t._v(" "),t._m(27),t._m(28),t._m(29),t._v(" "),s("p",[t._v("helm 通过 gRPC 将 chart 发送至 Tiller，Tiller 则通过内置的 Kubernetes 客户端与Kubernetes 的API Server 进行交流，将 chart 进行部署，并生成 Release 用于管理")]),t._v(" "),t._m(30),s("p",[t._v("Tiller 默认采用 ClusterIP 类型的 Service 进行部署，但是 ClusterIP 类型的 Service 仅限于集群内访问，所以 Helm 通过 socat 的端口转发，进而实现本地与 Tiller 的通信")])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"kubernetes-中安装-helm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-中安装-helm","aria-hidden":"true"}},[this._v("#")]),this._v(" Kubernetes 中安装 Helm")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Helm 是构建于 Kubernetes 之上的包管理器，可以理解为 yum，homebrew 或者 pip，用于简化包分发，安装，版本管理等操作流程")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"基本概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本概念","aria-hidden":"true"}},[this._v("#")]),this._v(" 基本概念")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Chart")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Release")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Repository")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Config\nConfig 用于部署 chart 时自定义配置，在部署的时候，会将 Config 和 chart 进行合并，共同构成将部署的应用")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"客户端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端","aria-hidden":"true"}},[this._v("#")]),this._v(" 客户端")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Mac")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("brew "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("install")]),this._v(" kubernetes-helm\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Ubuntu")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" snap "),e("span",{pre:!0,attrs:{class:"token function"}},[this._v("install")]),this._v(" helm --classic\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"服务端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务端","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务端")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("服务端安装要求 "),e("code",[this._v("$HOME/.kube/config")]),this._v("配置正确且有"),e("code",[this._v("kubectl")]),this._v("操作权限")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("创建账户")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tiller\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tiller\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tiller\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("kubectl apply -f tiller-rbac.yaml\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("安装")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("helm init --service-account tiller\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这种方式默认会使用 "),e("code",[this._v("gcr.io/kubernetes-helm/tiller")]),this._v("，可以通过指定镜像的方式初始化")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("helm init --upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.11.0 --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts --service-account tiller\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("Creating /root/.helm\nCreating /root/.helm/repository\nCreating /root/.helm/repository/cache\nCreating /root/.helm/repository/local\nCreating /root/.helm/plugins\nCreating /root/.helm/starters\nCreating /root/.helm/cache/archive\nCreating /root/.helm/repository/repositories.yaml\nAdding stable repo with URL: https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts\nAdding local repo with URL: http://127.0.0.1:8879/charts\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[this._v("$HELM_HOME")]),this._v(" has been configured at /root/.helm.\n\nTiller "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("(")]),this._v("the Helm server-side component"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(")")]),this._v(" has been upgraded to the current version.\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("查看版本")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("helm version\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("Client: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("version.Version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SemVer:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v2.11.0"')]),t._v(", GitCommit:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"79d07943b03aea2b76c12644b4b54733bc5958d6"')]),t._v(", GitTreeState:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clean"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nServer: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("version.Version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SemVer:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v2.11.0"')]),t._v(", GitCommit:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2e55dbe1fdb5fdb96b75ff144a339489417b146b"')]),t._v(", GitTreeState:"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"clean"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("查看 deploy")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("kubectl -n kube-system get deploy tiller-deploy\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("NAME            READY   UP-TO-DATE   AVAILABLE   AGE\ntiller-deploy   1/1     1            1           91s\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"工作原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#工作原理","aria-hidden":"true"}},[this._v("#")]),this._v(" 工作原理")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get svc -o wide -n kube-system\n\nNAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ntiller-deploy   ClusterIP   10.107.157.104   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        44134/TCP                24h    app"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("helm,name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tiller\n")])])])}],!1,null,null,null);r.options.__file="Kubernetes-中安装-Helm.md";e.default=r.exports}}]);