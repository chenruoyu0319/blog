(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{189:function(t,a,e){"use strict";e.r(a);var s=e(0),r=Object(s.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("ul",[e("li",[t._v("项目地址："),e("a",{attrs:{href:"https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-Flyway",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-Flyway"),e("OutboundLink")],1)])]),t._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://flywaydb.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("Flyway"),e("OutboundLink")],1),t._v(" 是一个数据库版本管理工具，用于管理数据库操作脚本")])]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),e("p",[t._v("此时启动应用，Flyway 将会自动执行脚本进行数据库操作")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._m(16),t._v(" "),e("blockquote",[e("p",[t._v("如果按照 Flyway "),e("a",{attrs:{href:"https://flywaydb.org/documentation/plugins/springboot",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),e("OutboundLink")],1),t._v(" 的指导，仅配置 Flyway，应用启动时并不会执行 Flyway 的任何操作，这是因为 "),e("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/1.4.x/api/org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration.html",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("FlywayAutoConfiguration")]),e("OutboundLink")],1),t._v(" 类在启动时要求有 DataSource 的实例，如果没有配置，就不会执行 Flyway，所以在依赖里添加了 MyBatis(或 JPA) ，使用 MyBatis(或 JPA) 时会自动注入数据源，因此才会执行 Flyway，具体可以参考"),e("a",{attrs:{href:"https://github.com/spring-projects/spring-boot/issues/8649",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/spring-projects/spring-boot/issues/8649"),e("OutboundLink")],1),t._v(" 和 "),e("a",{attrs:{href:"https://stackoverflow.com/questions/43496506/how-to-debug-when-flyway-doesnt-work-on-spring-boot",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://stackoverflow.com/questions/43496506/how-to-debug-when-flyway-doesnt-work-on-spring-boot"),e("OutboundLink")],1)])]),t._v(" "),t._m(17)])},[function(){var t=this.$createElement,a=this._self._c||t;return a("h1",{attrs:{id:"spring-boot-使用-flyway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-使用-flyway","aria-hidden":"true"}},[this._v("#")]),this._v(" Spring Boot 使用 Flyway")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"添加依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加依赖","aria-hidden":"true"}},[this._v("#")]),this._v(" 添加依赖")])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"language-groovy extra-class"},[e("pre",{pre:!0,attrs:{class:"language-groovy"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("compile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.flywaydb:flyway-core'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("compile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'org.mybatis.spring.boot:mybatis-spring-boot-starter:1.3.1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("runtime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql:mysql-connector-java'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//runtime('com.h2database:h2')")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[this._v("配置数据库")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"language-properties extra-class"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# H2 数据库")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#spring.datasource.url=jdbc:h2:mem:test")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#spring.datasource.username=root")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#spring.datasource.password=123456")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#spring.datasource.driver-class-name=org.h2.Driver")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# MySQL 数据库")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.datasource.driver-class-name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("com.mysql.jdbc.Driver")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.datasource.url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("jdbc:mysql://localhost:3306/product?useSSL=false")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.datasource.username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("root")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.datasource.password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("123456")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[this._v("使用 "),a("code",[this._v("V_VARSION__DESCRIPTION.sql")]),this._v(" 方式命名脚本")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"language-sql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" product"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  id "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  name "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VARCHAR")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  price "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DOUBLE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[this._v("将 SQL 脚本放在 "),a("code",[this._v("resources/db/migration")]),this._v(" 目录下")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[this._v("第一次启动时将会看到如下日志")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-log extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("2018-01-07 21:00:14.932  INFO 5041 --- [           main] o.f.core.internal.util.VersionPrinter    : Flyway 3.2.1 by Boxfuse\n2018-01-07 21:00:17.015  INFO 5041 --- [           main] o.f.c.i.dbsupport.DbSupportFactory       : Database: jdbc:mysql://localhost:3306/product?useSSL=false (MySQL 5.7)\n2018-01-07 21:00:17.253  INFO 5041 --- [           main] o.f.core.internal.command.DbValidate     : Validated 1 migration (execution time 00:00.133s)\n2018-01-07 21:00:17.750  INFO 5041 --- [           main] o.f.c.i.metadatatable.MetaDataTableImpl  : Creating Metadata table: `product`.`schema_version`\n2018-01-07 21:00:18.437  INFO 5041 --- [           main] o.f.core.internal.command.DbMigrate      : Current version of schema `product`: << Empty Schema >>\n2018-01-07 21:00:18.437  INFO 5041 --- [           main] o.f.core.internal.command.DbMigrate      : Migrating schema `product` to version 1.0 - 0001 CREATE PRODUCT\n2018-01-07 21:00:19.284  INFO 5041 --- [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 1 migration to schema `product` (execution time 00:01.592s).\n\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[this._v("再次启动将会看到 Flyway 校验版本")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-log extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("2018-01-07 21:02:09.195  INFO 5061 --- [           main] o.f.core.internal.util.VersionPrinter    : Flyway 3.2.1 by Boxfuse\n2018-01-07 21:02:11.327  INFO 5061 --- [           main] o.f.c.i.dbsupport.DbSupportFactory       : Database: jdbc:mysql://localhost:3306/product?useSSL=false (MySQL 5.7)\n2018-01-07 21:02:11.618  INFO 5061 --- [           main] o.f.core.internal.command.DbValidate     : Validated 1 migration (execution time 00:00.202s)\n2018-01-07 21:02:12.386  INFO 5061 --- [           main] o.f.core.internal.command.DbMigrate      : Current version of schema `product`: 1.0\n2018-01-07 21:02:12.447  INFO 5061 --- [           main] o.f.core.internal.command.DbMigrate      : Schema `product` is up to date. No migration necessary.\n\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[this._v("如果不想 Flyway 执行，可以配置不启用 Flyway")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[this._v("flyway.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[this._v("false")]),this._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意","aria-hidden":"true"}},[this._v("#")]),this._v(" 注意")])},function(){var t=this.$createElement,a=this._self._c||t;return a("blockquote",[a("ul",[a("li",[this._v("如果是多个数据源，则需要在 Flyway 进行操作的数据源 Bean 上添加 "),a("code",[this._v("@FlywayDataSource")]),this._v("注解或者在 "),a("code",[this._v("application.properties")]),this._v(" 里添加 "),a("code",[this._v("spring.flyway.[url,user,password]")]),this._v("进行配置")])])])}],!1,null,null,null);r.options.__file="SpringBoot-使用-Flyway.md";a.default=r.exports}}]);